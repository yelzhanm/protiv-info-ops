{% extends "base.html" %}

{% block title %}{{ t['admin_panel'] }} - {{ t['app_title'] }}{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-8">
  <h1
    class="text-4xl font-display font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-neon-purple to-neon-cyan">
    <i class="fas fa-user-shield mr-3"></i>
    {{ t['admin_panel'] }}
  </h1>
  <p class="text-gray-400">–•–∞–±–∞—Ä–ª–∞–º–∞–ª–∞—Ä–¥—ã —Ç–∞–ª–¥–∞—É –∂”ô–Ω–µ –±–∞—Å“õ–∞—Ä—É</p>
</div>

<!-- Main Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">

  <!-- Left: NLP Analysis Form -->
  <div class="lg:col-span-1">
    <div class="glass p-6 rounded-2xl sticky top-24">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <i class="fas fa-robot text-neon-cyan"></i>
        {{ t['nlp_analysis'] }}
      </h2>

      <form id="analysisForm" class="space-y-4">
        <div>
          <label class="block text-sm font-bold mb-2 text-gray-300">{{ t['text'] }}</label>
          <textarea id="textInput" rows="6"
            class="w-full px-4 py-3 bg-space-light/50 border-2 border-neon-purple/30 rounded-xl text-white placeholder-gray-500 focus:border-neon-purple focus:shadow-neon-purple focus:outline-none transition-all resize-none"
            placeholder="{{ t['enter_text'] }}" required></textarea>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-bold mb-2 text-gray-300">{{ t['channel'] }}</label>
            <input type="text" id="channelInput" value="Manual Input"
              class="w-full px-4 py-2 bg-space-light/50 border-2 border-neon-purple/30 rounded-xl text-white focus:border-neon-purple focus:shadow-neon-purple focus:outline-none transition-all">
          </div>
          <div>
            <label class="block text-sm font-bold mb-2 text-gray-300">{{ t['date'] }}</label>
            <input type="datetime-local" id="dateInput"
              class="w-full px-4 py-2 bg-space-light/50 border-2 border-neon-purple/30 rounded-xl text-white focus:border-neon-purple focus:shadow-neon-purple focus:outline-none transition-all">
          </div>
        </div>

        <button type="submit"
          class="w-full btn-glow py-3 rounded-xl font-bold bg-gradient-to-r from-neon-purple to-neon-cyan hover:shadow-neon-purple transition-all text-white flex items-center justify-center gap-2 group">
          <i class="fas fa-microscope"></i>
          <span>{{ t['analyze'] }}</span>
          <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
        </button>
      </form>

      <!-- Analysis Results -->
      <div id="analysisResults" class="mt-6 hidden space-y-4">
        <div class="h-px bg-gradient-to-r from-transparent via-neon-purple to-transparent"></div>

        <div class="glass p-4 rounded-xl border border-neon-purple/20">
          <h3 class="text-sm font-bold mb-3 text-neon-cyan flex items-center gap-2">
            <i class="fas fa-info-circle"></i>
            –ñ–∞–ª–ø—ã –∞“õ–ø–∞—Ä–∞—Ç
          </h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-400">IO —Ç“Ø—Ä—ñ:</span>
              <span id="resIOType" class="font-bold text-neon-purple"></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">–§–µ–π–∫:</span>
              <span id="resFakeClaim"></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">–≠–º–æ—Ü–∏—è:</span>
              <span id="resEmotion"></span>
            </div>
          </div>
        </div>

        <div class="glass p-4 rounded-xl border border-neon-cyan/20">
          <h3 class="text-sm font-bold mb-3 text-neon-cyan flex items-center gap-2">
            <i class="fas fa-tags"></i>
            –ê—Ç–∞—É–ª–∞—Ä (NER)
          </h3>
          <div id="resEntities" class="flex flex-wrap gap-2"></div>
        </div>

        <div class="glass p-4 rounded-xl border border-neon-green/20">
          <h3 class="text-sm font-bold mb-3 text-neon-green flex items-center gap-2">
            <i class="fas fa-book"></i>
            ”ò—Å–∫–µ—Ä–∏ —Ç–µ—Ä–º–∏–Ω–¥–µ—Ä
          </h3>
          <div id="resTerms" class="flex flex-wrap gap-2"></div>
        </div>

        <div class="glass p-4 rounded-xl border border-neon-purple/20">
          <h3 class="text-sm font-bold mb-3 text-neon-purple flex items-center gap-2">
            <i class="fas fa-brain"></i>
            LLM —Ç–∞–ª–¥–∞—É—ã
          </h3>
          <p id="resSummary" class="text-sm text-gray-400 mb-2"></p>
          <div id="resThreat" class="text-sm"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right: Message Feed -->
  <div class="lg:col-span-2">
    <div class="glass p-6 rounded-2xl">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold flex items-center gap-2">
          <i class="fas fa-stream text-neon-green"></i>
          {{ t['message_feed'] }}
        </h2>
        <span id="totalCount" class="px-3 py-1 rounded-full bg-neon-green/20 text-neon-green text-sm font-bold">
          {{ data|length }} —Ö–∞–±–∞—Ä–ª–∞–º–∞
        </span>
      </div>

      <!-- üÜï –ü–ê–ì–ò–ù–ê–¶–ò–Ø: –§–∏–ª—å—Ç—Ä—ã -->
      <div class="mb-4 flex gap-2">
        <input type="text" id="sourceFilter" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É..."
          class="flex-1 px-4 py-2 bg-space-light/50 border border-neon-purple/30 rounded-lg text-white text-sm focus:border-neon-purple focus:outline-none">
        <button onclick="loadMessages(1)"
          class="px-4 py-2 rounded-lg bg-neon-purple/20 hover:bg-neon-purple/30 text-neon-purple transition-colors text-sm">
          <i class="fas fa-filter"></i>
        </button>
      </div>

      <!-- Table -->
      <div class="overflow-x-auto">
        <table id="messageTable" class="w-full">
          <thead>
            <tr class="text-left text-xs text-gray-400 uppercase tracking-wider">
              <th class="pb-3">{{ t['source'] }}</th>
              <th class="pb-3">{{ t['date'] }}</th>
              <th class="pb-3">{{ t['text'] }}</th>
              <th class="pb-3">{{ t['io_type'] }}</th>
              <th class="pb-3">–≠–º–æ—Ü–∏—è</th>
              <th class="pb-3">–§–µ–π–∫</th>
              <th class="pb-3">”ò—Ä–µ–∫–µ—Ç</th>
            </tr>
          </thead>
          <tbody id="messageTableBody">
            <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
          </tbody>
        </table>
      </div>

      <!-- üÜï –ü–ê–ì–ò–ù–ê–¶–ò–Ø: –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
      <div id="paginationControls" class="mt-6 flex items-center justify-between">
        <div id="paginationInfo" class="text-sm text-gray-400">
          –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
        <div id="paginationButtons" class="flex gap-2">
          <!-- –ö–Ω–æ–ø–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Message Analysis Panel -->
<div class="glass p-6 rounded-2xl">
  <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
    <i class="fas fa-magnifying-glass-chart text-neon-cyan"></i>
    {{ t['message_analysis'] }}
  </h2>
  <div id="analysisContent" class="min-h-[200px] flex items-center justify-center">
    <div class="text-center text-gray-500">
      <i class="fas fa-hand-pointer text-4xl mb-3 opacity-30"></i>
      <p>–•–∞–±–∞—Ä–ª–∞–º–∞–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑</p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // üÜï –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ü–ê–ì–ò–ù–ê–¶–ò–ò
  let currentPage = 1;
  let totalPages = 1;
  let perPage = 10;

  $(document).ready(function () {
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    loadMessages(1);

    // Analysis form submission
    $('#analysisForm').on('submit', function (e) {
      e.preventDefault();

      const text = $('#textInput').val().trim();
      const channel = $('#channelInput').val().trim();
      let date = $('#dateInput').val();

      if (!text) {
        Utils.showError('–ú”ô—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑', '–¢–∞–ª–¥–∞—É “Ø—à—ñ–Ω –º”ô—Ç—ñ–Ω –º—ñ–Ω–¥–µ—Ç—Ç—ñ');
        return;
      }

      if (!date) {
        const now = new Date();
        date = now.toISOString().slice(0, 19);
      } else {
        date = date.replace('T', ' ') + ':00';
      }

      Utils.showLoading('{{ t["analyzing"] }}');

      $.ajax({
        url: '/analyze',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ text, channel, date }),
        success: function (data) {
          Utils.hideLoading();
          displayAnalysisResults(data);
          Utils.showSuccess('{{ t["analysis_complete"] }}');
          $('#textInput').val('');

          // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
          loadMessages(currentPage);
        },
        error: function (xhr) {
          Utils.hideLoading();
          Utils.showError(xhr.responseJSON?.detail || '–¢–∞–ª–¥–∞—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã');
        }
      });
    });
  });

  // üÜï –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –°–û–û–ë–©–ï–ù–ò–ô –° –ü–ê–ì–ò–ù–ê–¶–ò–ï–ô
  function loadMessages(page) {
    currentPage = page;
    const source = $('#sourceFilter').val().trim();

    let url = `/api/messages/paginated?page=${page}&per_page=${perPage}`;
    if (source) url += `&source=${encodeURIComponent(source)}`;

    $.ajax({
      url: url,
      method: 'GET',
      success: function (data) {
        renderMessages(data.messages);
        renderPagination(data.pagination);
      },
      error: function () {
        Utils.showError('–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã');
      }
    });
  }

  // üÜï –û–¢–†–ò–°–û–í–ö–ê –°–û–û–ë–©–ï–ù–ò–ô
  function renderMessages(messages) {
    const tbody = $('#messageTableBody');
    tbody.empty();

    if (messages.length === 0) {
      tbody.append(`
        <tr>
          <td colspan="7" class="py-8 text-center text-gray-500">
            <i class="fas fa-inbox text-4xl mb-2 opacity-30"></i>
            <p>–•–∞–±–∞—Ä–ª–∞–º–∞–ª–∞—Ä –∂–æ“õ</p>
          </td>
        </tr>
      `);
      return;
    }

    messages.forEach(item => {
      const row = `
        <tr class="group cursor-pointer message-row" 
            data-id="${item.id}" 
            data-source="${item.source || '‚Äî'}"
            data-date="${item.date || '‚Äî'}" 
            data-text="${escapeHtml(item.text || '‚Äî')}" 
            data-io="${item.io_type || '‚Äî'}"
            data-emo="${item.emo_eval || '‚Äî'}" 
            data-fake="${item.fake_claim || '‚Äî'}">
          <td class="py-3 rounded-l-xl bg-space-light/30 group-hover:bg-neon-purple/10 transition-colors px-3">
            <span class="text-sm">${item.source || '‚Äî'}</span>
          </td>
          <td class="py-3 bg-space-light/30 group-hover:bg-neon-purple/10 transition-colors px-3">
            <span class="text-xs text-gray-400">${item.date ? item.date.slice(0, 16) : '‚Äî'}</span>
          </td>
          <td class="py-3 bg-space-light/30 group-hover:bg-neon-purple/10 transition-colors px-3">
            <span class="text-sm truncate max-w-xs block">${item.text ? item.text.slice(0, 50) + '...' : '‚Äî'}</span>
          </td>
          <td class="py-3 bg-space-light/30 group-hover:bg-neon-purple/10 transition-colors px-3">
            ${item.io_type ? `<span class="px-2 py-1 rounded-lg bg-neon-purple/20 text-neon-purple text-xs font-bold border border-neon-purple/30">${item.io_type.slice(0, 15)}</span>` : '<span class="text-gray-500">‚Äî</span>'}
          </td>
          <td class="py-3 bg-space-light/30 group-hover:bg-neon-purple/10 transition-colors px-3">
            <span class="text-sm">${item.emo_eval || '‚Äî'}</span>
          </td>
          <td class="py-3 bg-space-light/30 group-hover:bg-neon-purple/10 transition-colors px-3">
            ${item.fake_claim === 'True' ? '<span class="px-2 py-1 rounded-lg bg-neon-red/20 text-neon-red text-xs font-bold border border-neon-red/30">{{ t["true"] }}</span>' :
          item.fake_claim === 'False' ? '<span class="px-2 py-1 rounded-lg bg-neon-green/20 text-neon-green text-xs font-bold border border-neon-green/30">{{ t["false"] }}</span>' :
            '<span class="text-gray-500">‚Äî</span>'}
          </td>
          <td class="py-3 rounded-r-xl bg-space-light/30 group-hover:bg-neon-purple/10 transition-colors px-3">
            <button class="delete-btn px-3 py-1 rounded-lg bg-neon-red/20 hover:bg-neon-red/30 text-neon-red transition-colors text-xs" data-id="${item.id}">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
      tbody.append(row);
    });

    // –ü—Ä–∏–≤—è–∑–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    attachRowHandlers();
  }

  // üÜï –û–¢–†–ò–°–û–í–ö–ê –ü–ê–ì–ò–ù–ê–¶–ò–ò
  function renderPagination(pagination) {
    totalPages = pagination.total_pages;

    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    $('#paginationInfo').html(`
      –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pagination.page} –∏–∑ ${totalPages} 
      <span class="text-gray-600">(–≤—Å–µ–≥–æ ${pagination.total} –∑–∞–ø–∏—Å–µ–π)</span>
    `);

    $('#totalCount').text(`${pagination.total} —Ö–∞–±–∞—Ä–ª–∞–º–∞`);

    // –ö–Ω–æ–ø–∫–∏
    const buttons = $('#paginationButtons');
    buttons.empty();

    // –ü—Ä–µ–¥—ã–¥—É—â–∞—è
    if (pagination.has_prev) {
      buttons.append(`
        <button onclick="loadMessages(${pagination.page - 1})" 
                class="px-3 py-2 rounded-lg bg-neon-purple/20 hover:bg-neon-purple/30 text-neon-purple transition-colors text-sm">
          <i class="fas fa-chevron-left"></i>
        </button>
      `);
    }

    // –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º 5 –∫–Ω–æ–ø–æ–∫)
    const startPage = Math.max(1, pagination.page - 2);
    const endPage = Math.min(totalPages, pagination.page + 2);

    // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    if (startPage > 1) {
      buttons.append(`
        <button onclick="loadMessages(1)" 
                class="px-3 py-2 rounded-lg bg-space-light/50 hover:bg-neon-purple/20 text-gray-400 hover:text-white transition-colors text-sm">
          1
        </button>
      `);
      if (startPage > 2) {
        buttons.append('<span class="px-2 text-gray-600">...</span>');
      }
    }

    // –°—Ä–µ–¥–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    for (let i = startPage; i <= endPage; i++) {
      const isActive = i === pagination.page;
      buttons.append(`
        <button onclick="loadMessages(${i})" 
                class="px-3 py-2 rounded-lg ${isActive ? 'bg-gradient-to-r from-neon-purple to-neon-cyan text-white shadow-neon-purple' : 'bg-space-light/50 hover:bg-neon-purple/20 text-gray-400 hover:text-white'} transition-colors text-sm font-bold">
          ${i}
        </button>
      `);
    }

    // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        buttons.append('<span class="px-2 text-gray-600">...</span>');
      }
      buttons.append(`
        <button onclick="loadMessages(${totalPages})" 
                class="px-3 py-2 rounded-lg bg-space-light/50 hover:bg-neon-purple/20 text-gray-400 hover:text-white transition-colors text-sm">
          ${totalPages}
        </button>
      `);
    }

    // –°–ª–µ–¥—É—é—â–∞—è
    if (pagination.has_next) {
      buttons.append(`
        <button onclick="loadMessages(${pagination.page + 1})" 
                class="px-3 py-2 rounded-lg bg-neon-purple/20 hover:bg-neon-purple/30 text-neon-purple transition-colors text-sm">
          <i class="fas fa-chevron-right"></i>
        </button>
      `);
    }
  }

  // üÜï –ü–†–ò–í–Ø–ó–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –ö –°–¢–†–û–ö–ê–ú
  function attachRowHandlers() {
    // –ö–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ
    $('.message-row').off('click').on('click', function (e) {
      if ($(e.target).closest('.delete-btn').length) return;

      $('.message-row').removeClass('!bg-neon-purple/20');
      $(this).addClass('!bg-neon-purple/20');

      const data = {
        source: $(this).data('source'),
        date: $(this).data('date'),
        text: $(this).data('text'),
        io: $(this).data('io'),
        emo: $(this).data('emo'),
        fake: $(this).data('fake')
      };

      displayMessageAnalysis(data);
    });

    // –£–¥–∞–ª–µ–Ω–∏–µ
    $('.delete-btn').off('click').on('click', function (e) {
      e.stopPropagation();
      const id = $(this).data('id');

      Swal.fire({
        title: '{{ t["confirm_delete"] }}?',
        text: '–ë“±–ª ”ô—Ä–µ–∫–µ—Ç—Ç—ñ “õ–∞–π—Ç–∞—Ä—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#EF4444',
        cancelButtonColor: '#6B7280',
        confirmButtonText: '{{ t["yes"] }}, ”©—à—ñ—Ä—É',
        cancelButtonText: '{{ t["cancel"] }}',
        background: '#1E293B',
        color: '#F1F5F9'
      }).then((result) => {
        if (result.isConfirmed) {
          $.post(`/delete/${id}`, () => loadMessages(currentPage));
        }
      });
    });
  }

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
  function escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
  }

  // Display analysis results (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  function displayAnalysisResults(data) {
    const analysis = data.analysis_report;
    const sentiment = analysis.general_sentiment;

    $('#resIOType').text(analysis.predicted_info_operation_type || '‚Äî');

    const fakeText = analysis.is_anomaly ? '{{ t["true"] }}' : '{{ t["false"] }}';
    const fakeClass = analysis.is_anomaly ? 'text-neon-red' : 'text-neon-green';
    $('#resFakeClaim').html(`<span class="${fakeClass} font-bold">${fakeText}</span>`);

    const emoClass = sentiment.label.includes('POSITIVE') ? 'text-neon-green' : sentiment.label.includes('NEGATIVE') ? 'text-neon-red' : 'text-gray-400';
    $('#resEmotion').html(`<span class="${emoClass} font-bold">${sentiment.label}</span> <span class="text-xs text-gray-500">(${(sentiment.score * 100).toFixed(1)}%)</span>`);

    if (analysis.named_entities_recognition.length > 0) {
      const entities = analysis.named_entities_recognition.map(e =>
        `<span class="px-2 py-1 rounded-lg bg-neon-cyan/20 text-neon-cyan text-xs font-bold border border-neon-cyan/30">${e.word} <span class="opacity-50">(${e.entity})</span></span>`
      ).join(' ');
      $('#resEntities').html(entities);
    } else {
      $('#resEntities').html('<span class="text-gray-500 text-xs">–ê—Ç–∞—É–ª–∞—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã</span>');
    }

    if (analysis.military_terms_analysis.length > 0) {
      const terms = analysis.military_terms_analysis.map(t =>
        `<span class="px-2 py-1 rounded-lg bg-neon-green/20 text-neon-green text-xs font-bold border border-neon-green/30" title="${t.matched_alias}">${t.term_kz || t.term_ru || t.term_en}</span>`
      ).join(' ');
      $('#resTerms').html(terms);
    } else {
      $('#resTerms').html('<span class="text-gray-500 text-xs">–¢–µ—Ä–º–∏–Ω–¥–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã</span>');
    }

    const llm = analysis.llm_expert_summary;
    $('#resSummary').text(llm.summary || 'LLM —Ç–∞–ª–¥–∞—É—ã –∂–æ“õ');

    const threat = llm.threat_level || 0;
    let threatColor = 'text-neon-green';
    let threatIcon = 'shield-halved';
    if (threat >= 4) {
      threatColor = 'text-neon-red';
      threatIcon = 'skull';
    } else if (threat === 3) {
      threatColor = 'text-yellow-500';
      threatIcon = 'triangle-exclamation';
    }

    $('#resThreat').html(`
      <div class="flex items-center gap-2 ${threatColor}">
        <i class="fas fa-${threatIcon}"></i>
        <span class="font-bold">“ö–∞—É—ñ–ø –¥–µ“£–≥–µ–π—ñ: ${threat}/5</span>
      </div>
    `);

    $('#analysisResults').removeClass('hidden');
  }

  // Display message analysis (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  function displayMessageAnalysis(data) {
    const fakeClass = data.fake === 'True' ? 'text-neon-red' : data.fake === 'False' ? 'text-neon-green' : 'text-gray-400';

    $('#analysisContent').html(`
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full">
        <div class="glass p-4 rounded-xl">
          <div class="text-xs text-gray-400 mb-1">–î–µ—Ä–µ–∫–∫”©–∑</div>
          <div class="font-bold">${data.source}</div>
        </div>
        <div class="glass p-4 rounded-xl">
          <div class="text-xs text-gray-400 mb-1">–ö“Ø–Ω—ñ</div>
          <div class="font-bold">${data.date}</div>
        </div>
        <div class="glass p-4 rounded-xl">
          <div class="text-xs text-gray-400 mb-1">IO —Ç“Ø—Ä—ñ</div>
          <div class="font-bold text-neon-purple">${data.io}</div>
        </div>
        <div class="glass p-4 rounded-xl">
          <div class="text-xs text-gray-400 mb-1">–≠–º–æ—Ü–∏—è</div>
          <div class="font-bold">${data.emo}</div>
        </div>
        <div class="glass p-4 rounded-xl">
          <div class="text-xs text-gray-400 mb-1">–§–µ–π–∫ –¥–µ—Ä–µ–∫—Ç–µ–º–µ</div>
          <div class="font-bold ${fakeClass}">${data.fake}</div>
        </div>
        <div class="glass p-4 rounded-xl col-span-1 md:col-span-3">
          <div class="text-xs text-gray-400 mb-2">–ú”ô—Ç—ñ–Ω</div>
          <div class="text-sm leading-relaxed">${data.text}</div>
        </div>
      </div>
    `);
  }
</script>
{% endblock %}